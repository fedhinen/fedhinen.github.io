---
import { getCollection } from 'astro:content';
import { useTranslations } from '../i18n/utils';

interface Props {
    lang: 'es' | 'en';
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const projects = await getCollection('projects', ({ data }) => {
    return data.lang === lang;
});

const sortedProjects = projects.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<section id="projects" class="py-12 border-t border-gray-800">
    <h2 class="text-2xl font-bold mb-8 flex items-center gap-2">
        <span class="text-primary">#</span> {t('section.projects')}
    </h2>

    {sortedProjects.length === 0 ? (
        <div class="p-8 border border-dashed border-gray-800 rounded-lg text-center text-gray-500">
            <p>{t('projects.empty')}</p>
        </div>
    ) : (
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {sortedProjects.map((project) => (
                <article class="p-6 bg-bg-card rounded-lg border border-gray-200 hover:border-primary transition-all hover:shadow-lg group">
                    <h3 class="text-xl font-bold mb-2 group-hover:text-primary transition-colors">
                        <a href={`/${lang === 'es' ? 'projects' : 'en/projects'}/${project.slug}`} class="no-underline">
                            {project.data.title}
                        </a>
                    </h3>
                    <p class="text-gray-600 mb-4 text-sm leading-relaxed">
                        {project.data.description}
                    </p>
                    <div class="flex flex-wrap gap-2 mb-4">
                        {project.data.tags.map((tag) => (
                            <span class="px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded border border-gray-200">
                                {tag}
                            </span>
                        ))}
                    </div>
                    <div class="flex gap-4 text-sm">
                        <a href={`/${lang === 'es' ? 'projects' : 'en/projects'}/${project.slug}`} class="flex items-center gap-1 text-primary font-medium hover:underline">
                            <span>{lang === 'es' ? 'Ver detalles' : 'View details'} &rarr;</span>
                        </a>
                    </div>
                </article>
            ))}
        </div>
    )}
</section>
